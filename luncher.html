<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Speaq Quiz Signup Launcher</title>
</head>
<body>
  <p>Loading signup...</p>
  <iframe id="signupFrame" src="" style="width:100%; height:800px; border:none;"></iframe>

  <script>
    // Get referral from query string
    const params = new URLSearchParams(window.location.search);
    const ref = params.get("ref");

    // Store in localStorage (optional backup)
    if (ref) {
      localStorage.setItem("pendingReferral", ref);
    }

    // Load the app with referral in iframe
    const iframe = document.getElementById("signupFrame");
    const iframeBaseUrl = "https://script.google.com/macros/s/AKfycbwRq1lHnNX6vpg3FSh3NJCDCdi6aZoBOaEHj4_K_BkFBl2cxhk9Gbc6OU8v5XTyNz09/exec";
    iframe.src = ref ? `${iframeBaseUrl}?ref=${encodeURIComponent(ref)}` : iframeBaseUrl;

    // Listen for signupComplete message from iframe
    window.addEventListener("message", function(event) {
      if (event.origin !== "https://script.google.com") return; // Security check

      const data = event.data;
      if (data.type === "signupComplete" && data.status === "success") {
        console.log("ðŸŽ‰ Signup success reported from iframe");
        // Delay then redirect
        setTimeout(() => {
          window.location.href = "https://sites.google.com/view/speaqquiz"; // Your Google Site login
        }, 10000); // 10 seconds
      }
    });
  </script>
</body>
</html>

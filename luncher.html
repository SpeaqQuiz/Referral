<!DOCTYPE html>
<html>
<head>
  <title>Referral Redirect</title>
  <meta charset="UTF-8">
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const params = new URLSearchParams(window.location.search);
      const ref = params.get("ref");

      if (ref) {
        const encodedRef = encodeURIComponent(ref);

        // 1. Fire Apps Script call (doesn't block redirect)
        fetch(`https://script.google.com/macros/s/AKfycbwRq1lHnNX6vpg3FSh3NJCDCdi6aZoBOaEHj4_K_BkFBl2cxhk9Gbc6OU8v5XTyNz09/exec?ref=${encodedRef}`)
          .then(response => {
            console.log("Referral logged:", response.status);
          })
          .catch(err => {
            console.warn("Error logging referral:", err);
          });

        // 2. Redirect to Google Sites after a short delay
        setTimeout(() => {
          window.location.href = `https://sites.google.com/view/speaqquiz?ref=${encodedRef}`;
        }, 300); // delay just a bit to let the fetch fire
      } else {
        document.body.innerHTML = "<p>No referral code provided.</p>";
      }
    });
  </script>
</head>
<body>
  <p>Redirecting you now...</p>
</body>
</html>
